<!DOCTYPE html>
<html lang="ja" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>映画の詳細</title>

    <!-- BootstrapのCSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.0/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- BootstrapのJS（Popper含む） -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.0/dist/js/bootstrap.bundle.min.js"></script>
</head>
<body>
<div class="container mt-4">
    <div class="row">
        <div class="col-md-4">
            <img th:src="'https://image.tmdb.org/t/p/w500' + ${movie.posterPath}"
                 alt="ポスター画像"
                 style="height: 500px; object-fit: cover; width: 100%;">
        </div>
        <div class="col-md-8">
            <h2 th:text="${movie.title}">映画のタイトル</h2>
            <p><strong>公開日:</strong> <span th:text="${movie.releaseDate}">公開日</span></p>
            <p><strong>評価:</strong> <span th:text="${movie.voteAverage}">評価</span></p>
            <p><strong>上映時間:</strong> <span th:text="${movie.runtime} + '分'">上映時間</span></p>
            <th:block th:if="${youtube != null}">
                <div>
                    <iframe th:src="${youtube}"
                            width="560" height="315"
                            frameborder="0" allowfullscreen>
                    </iframe>
                </div>
            </th:block>
            <th:block th:unless="${youtube != null}">
                予告映像情報がありません
            </th:block>
            <div class="col-12">
                <h3>あらすじ</h3>
                <p th:text="${movie.overview}">あらすじがここに表示されます。</p>
            </div>
        </div>
    </div>

    <!-- タブ切り替え -->
    <ul class="nav nav-pills mt-4" id="myTab" role="tablist">
        <li class="nav-item" role="presentation">
            <a class="nav-link active" id="tmdb-tab" data-bs-toggle="pill" href="#tmdb" role="tab" aria-controls="tmdb"
               aria-selected="true">COMING SOON</a>
        </li>
        <li class="nav-item" role="presentation">
            <a class="nav-link" id="ameba-tab" data-bs-toggle="pill" href="#webAmeba" role="tab"
               aria-controls="webAmeba" aria-selected="false">Ameba.jp</a>
        </li>
        <li class="nav-item" role="presentation">
            <a class="nav-link" id="web-tab" data-bs-toggle="pill" href="#web" role="tab" aria-controls="web"
               aria-selected="false">Note.com</a>
        </li>
    </ul>

    <div class="tab-content mt-3" id="myTabContent">
        <!-- TMDB情報 -->
        <div class="tab-pane fade show active" id="tmdb" role="tabpanel" aria-labelledby="tmdb-tab">
            <h5>映画サイトでのレビュー</h5>
        </div>

        <!-- Ameba -->
        <div class="tab-pane fade" id="webAmeba" role="tabpanel" aria-labelledby="ameba-tab">
            <h5 class="mt-3">ameba.jpでの感想 ※使用しているAPIが無料プランのため10件までにしています</h5>
            <th:block th:if="${searchAmebaResults != null}">
                <ul class="list-group mt-3">
                    <li class="list-group-item" th:each="item, stat : ${searchAmebaResults}" th:if="${stat.count <= 10}">
                        <a th:href="${item.link}" th:text="${item.title}"
                           class="text-decoration-none text-dark" target="_blank"></a>
                    </li>
                </ul>
            </th:block>
            <th:block th:unless="${searchAmebaResults != null}">
                検索結果が存在しないか、デバッグモードでの実行によって非表示にされています。
            </th:block>
        </div>

        <!-- Note -->
        <div class="tab-pane fade" id="web" role="tabpanel" aria-labelledby="web-tab">
            <h5 class="mt-3">note.comでの感想 ※使用しているAPIが無料プランのため10件までにしています</h5>
            <th:block th:if="${searchNoteResults  != null}">
                <ul class="list-group mt-3">
                    <li class="list-group-item" th:each="item, stat : ${searchNoteResults}" th:if="${stat.count <= 10}">
                        <a th:href="${item.link}" th:text="${item.title}"
                           class="text-decoration-none text-dark" target="_blank"></a>
                    </li>
                </ul>
            </th:block>
            <th:block th:unless="${searchNoteResults != null}">
                検索結果が存在しないか、デバッグモードでの実行にによって非表示にされています。
            </th:block>
        </div>
    </div>

    <div class="container mt-5">
        <div class="row">
            <!-- th:each でレビューをループ -->
            <div class="col-md-4" th:each="review : ${reviews}">
                <div class="card mb-4" style="width: 18rem;">
                    <!-- アバター画像 -->
                    <img th:src="@{${review.avatarPath}}" class="card-img-top" alt="Avatar"
                         style="width: 50px; height: 50px; border-radius: 50%; margin: 10px;">

                    <div class="card-body">
                        <!-- 投稿者名 -->
                        <h5 class="card-title" th:text="${review.author}">John Doe</h5>

                        <!-- レビュー内容 -->
                        <p class="card-text" th:text="${review.content}">This movie was amazing!</p>

                        <!-- 投稿日 -->
                        <p class="card-text">
                            <small class="text-muted" th:text="${review.createdAt}">Posted on: 2025-05-01</small>
                        </p>

                        <!-- 評価 -->
                        <div>
                            <span th:text="'Rating: ' + ${review.rating}">Rating: 8.5</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

</div>

<script>
    // ページ読み込み時に最初のタブを表示
    document.addEventListener('DOMContentLoaded', function () {
        var firstTab = new bootstrap.Tab(document.getElementById('tmdb-tab'));
        firstTab.show();
    });
</script>

</body>
</html>
